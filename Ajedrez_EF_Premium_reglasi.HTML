<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajedrez Activo EF - D√≠as de Lluvia</title>
    <style>
        :root {
            --bg-color: #2d3436;
            --board-border: #4a332a;
            --cell-white: #f0d9b5;
            --cell-black: #b58863;
            --text-color: #ecf0f1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px 0;
            line-height: 1.6;
        }

        /* ================= ESTILOS GENERALES ================= */
        h1 { text-align: center; margin-bottom: 20px; text-shadow: 2px 2px 4px black; }
        button { cursor: pointer; font-family: inherit; transition: all 0.2s; }

        /* ================= SECCI√ìN REGLAS ================= */
        #rules-section {
            max-width: 900px; width: 95%; background-color: #34495e; padding: 30px;
            border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); margin-bottom: 20px;
        }
        .rules-title { color: #f1c40f; font-size: 2.5rem; font-family: 'Comic Sans MS', cursive, sans-serif; }
        .intro-box {
            text-align: center; font-size: 1.2rem; margin-bottom: 30px; background-color: #2c3e50;
            padding: 15px; border-radius: 10px; border: 2px solid #f1c40f;
        }
        .pieces-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .piece-card {
            background-color: #fff; color: #2c3e50; border-radius: 12px; padding: 15px;
            text-align: center; border-bottom: 5px solid #bdc3c7;
        }
        .piece-icon-rule { font-size: 4rem; margin-bottom: 5px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .piece-name { font-size: 1.3rem; font-weight: bold; color: #d35400; }
        .important-rules { margin-top: 30px; background-color: #e74c3c; color: white; padding: 20px; border-radius: 12px; }
        .start-btn {
            background-color: #27ae60; color: white; border: none; padding: 15px 40px; font-size: 1.5rem;
            border-radius: 50px; font-weight: bold; box-shadow: 0 5px 0 #219653; display: block; margin: 30px auto 0;
        }
        .start-btn:hover { background-color: #2ecc71; transform: translateY(3px); box-shadow: 0 2px 0 #219653; }

        /* ================= SECCI√ìN JUEGO ================= */
        #game-section { display: none; flex-direction: column; align-items: center; width: 100%; }
        
        .game-info {
            background: rgba(0, 0, 0, 0.3); padding: 10px 25px; border-radius: 50px; margin-bottom: 15px;
            display: flex; gap: 20px; align-items: center; font-size: 1.2rem; border: 2px solid rgba(255,255,255,0.1);
        }
        .turn-white { color: #81ecec; font-weight: bold; }
        .turn-black { color: #fab1a0; font-weight: bold; }

        /* Tablero */
        #board-container { padding: 10px; background-color: var(--board-border); border-radius: 5px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        #board { display: grid; grid-template-columns: repeat(8, 70px); grid-template-rows: repeat(8, 70px); user-select: none; }
        
        .cell { width: 70px; height: 70px; display: flex; align-items: center; justify-content: center; font-size: 50px; cursor: pointer; position: relative; }
        .white-cell { background-color: var(--cell-white); color: black; }
        .black-cell { background-color: var(--cell-black); color: black; }
        
        .piece-white { color: #fff; text-shadow: 1px 1px 2px #000; transition: transform 0.2s; }
        .piece-black { color: #000; text-shadow: 0px 0px 1px #fff; transition: transform 0.2s; }
        .cell:hover .piece-white, .cell:hover .piece-black { transform: scale(1.15); }

        .selected { background-color: #6c5ce7 !important; }
        .highlight::after { content: ''; position: absolute; width: 25px; height: 25px; background-color: rgba(0, 0, 0, 0.2); border-radius: 50%; pointer-events: none; }
        .capture { box-shadow: inset 0 0 15px 5px rgba(192, 57, 43, 0.8); }

        .game-controls { display: flex; gap: 10px; margin-top: 20px; }
        .btn-control { padding: 10px 20px; border: none; border-radius: 8px; font-size: 1rem; color: white; }
        .btn-back { background-color: #0984e3; }
        .btn-reset { background-color: #e17055; }

        /* ================= VENTANA MODAL RETO ================= */
        #challenge-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; flex-direction: column; backdrop-filter: blur(8px);
        }
        .modal-content {
            background: linear-gradient(135deg, #e17055, #d63031); /* Fondo rojo intenso para indicar alerta/penalizaci√≥n divertida */
            padding: 30px; border-radius: 20px; text-align: center; max-width: 90%; width: 450px;
            box-shadow: 0 0 40px rgba(214, 48, 49, 0.6); border: 4px solid white; animation: bounceIn 0.5s; color: white;
        }
        @keyframes bounceIn { 0% { transform: scale(0.3); opacity: 0; } 50% { transform: scale(1.05); } 70% { transform: scale(0.9); } 100% { transform: scale(1); opacity: 1; } }
        
        .modal-header { font-size: 1.2rem; margin: 0; text-transform: uppercase; letter-spacing: 1px; opacity: 0.9; }
        .modal-title { font-size: 2.5rem; margin: 10px 0; font-weight: bold; text-shadow: 2px 2px 0px rgba(0,0,0,0.3); }
        .loser-text { font-size: 1.1rem; background: rgba(0,0,0,0.2); padding: 5px 10px; border-radius: 5px; display: inline-block; margin-bottom: 20px;}
        
        .modal-task { 
            font-size: 1.6rem; font-weight: bold; margin: 10px 0 30px 0; background: white; color: #d63031; 
            padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-close-modal {
            background-color: white; color: #d63031; border: none; padding: 15px 35px; font-size: 1.3rem; 
            border-radius: 50px; font-weight: bold; box-shadow: 0 5px 0 #b2bec3; transition: transform 0.1s;
        }
        .btn-close-modal:active { transform: translateY(4px); box-shadow: 0 1px 0 #b2bec3; }

        /* Responsive */
        @media (max-width: 650px) {
            #board { grid-template-columns: repeat(8, 11vw); grid-template-rows: repeat(8, 11vw); }
            .cell { width: 11vw; height: 11vw; font-size: 7vw; }
            .rules-title { font-size: 1.8rem; }
        }
    </style>
</head>
<body>

    <div id="rules-section">
        <h1 class="rules-title">üëë Iniciaci√≥n al Ajedrez EF üëë</h1>
        <div class="intro-box"><strong>Objetivo:</strong> Capturar al Rey rival. <br>Cada vez que te coman una pieza... <strong>¬°Toca hacer ejercicio!</strong></div>

        <div class="pieces-grid">
            <div class="piece-card"><div class="piece-icon-rule">‚ôñ</div><div class="piece-name">Torre</div><div>L√≠neas rectas (cruz).</div></div>
            <div class="piece-card"><div class="piece-icon-rule">‚ôó</div><div class="piece-name">Alfil</div><div>Diagonales (X).</div></div>
            <div class="piece-card"><div class="piece-icon-rule">‚ôï</div><div class="piece-name">Dama</div><div>¬°Recto y diagonal!</div></div>
            <div class="piece-card"><div class="piece-icon-rule">‚ôò</div><div class="piece-name">Caballo</div><div>Salta en forma de "L".</div></div>
            <div class="piece-card"><div class="piece-icon-rule">‚ôô</div><div class="piece-name">Pe√≥n</div><div>Paso adelante. Come diagonal.</div></div>
            <div class="piece-card" style="background:#fffde7"><div class="piece-icon-rule" style="color:#f1c40f">‚ôî</div><div class="piece-name">Rey</div><div>El Jefe. Un pasito.</div></div>
        </div>

        <div class="important-rules">
            <h3>üö® Din√°mica de Educaci√≥n F√≠sica:</h3>
            <p>Ten preparada una <strong>bola de papel</strong> o un par de calcetines hechos bola. Cuando pierdas una ficha, la pantalla te dir√° qu√© reto debes cumplir antes de seguir jugando.</p>
        </div>

        <button class="start-btn" onclick="showGame()">üéÆ ¬°A Jugar y Moverse! üéÆ</button>
    </div>

    <div id="game-section">
        <h1>‚ôüÔ∏è Ajedrez Activo EF üèÉ‚Äç‚ôÇÔ∏è</h1>
        <div class="game-info"><span id="turn-text" class="turn-white">Turno: Blancas</span></div>
        <div id="board-container"><div id="board"></div></div>
        <div class="game-controls">
            <button class="btn-control btn-back" onclick="showRules()">‚¨Ö Reglas</button>
            <button class="btn-control btn-reset" onclick="initGame()">üîÑ Reiniciar</button>
        </div>
    </div>

    <div id="challenge-modal">
        <div class="modal-content">
            <p class="modal-header">¬°Ups! Pieza eliminada</p>
            <div class="modal-title">¬°TIEMPO DE RETO!</div>
            <div class="loser-text" id="loser-indicator">El jugador de las BLANCAS paga:</div>
            <div class="modal-task" id="challenge-text">...</div>
            <button class="btn-close-modal" onclick="closeModal()">¬°Hecho! (Seguir jugando)</button>
        </div>
    </div>

<script>
    // --- LISTA DE RETOS PARA EL AULA (Material: Bola de papel/Silla/Pupitre) ---
    const challenges = [
        "10 Jumping Jacks (Saltos de tijera)",
        "5 Flexiones (en suelo o inclinadas en mesa)",
        "10 Sentadillas (o sentarse y levantarse sin manos)",
        "Equilibrio: 10 seg. pata coja (Derecha)",
        "Equilibrio: 10 seg. pata coja (Izquierda)",
        "Coordinaci√≥n: 5 toques con bola de papel (pie)",
        "Lanzar bola al aire, aplaudir 2 veces y cogerla",
        "Correr en el sitio (rodillas altas) 10 seg.",
        "Equilibrio: Bola de papel en la cabeza 10 seg.",
        "Plancha abdominal (mesa o suelo): 15 seg.",
        "Pasar la bola en 'ocho' entre las piernas 5 veces",
        "Tocar el suelo y saltar a tocar el techo (5 veces)",
        "Estiramiento: Tocar punta de los pies 10 seg.",
        "Sim√≥n dice: Toca 3 cosas azules de la clase",
        "5 Giros de brazos hacia adelante y 5 atr√°s",
        "Hacer una 'V' con el cuerpo en la silla 5 seg."
    ];

    // Variables y Elementos
    const rulesSection = document.getElementById('rules-section');
    const gameSection = document.getElementById('game-section');
    const boardElement = document.getElementById('board');
    const turnText = document.getElementById('turn-text');
    const modal = document.getElementById('challenge-modal');
    const challengeTextElement = document.getElementById('challenge-text');
    const loserIndicator = document.getElementById('loser-indicator');

    const piecesSymbols = { 'p': '‚ôü', 't': '‚ôú', 'c': '‚ôû', 'a': '‚ôù', 'd': '‚ôõ', 'r': '‚ôö', 'P': '‚ôô', 'T': '‚ôñ', 'C': '‚ôò', 'A': '‚ôó', 'D': '‚ôï', 'R': '‚ôî' };
    const initialBoard = [
        ['t', 'c', 'a', 'd', 'r', 'a', 'c', 't'], ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
        ['', '', '', '', '', '', '', ''], ['', '', '', '', '', '', '', ''],
        ['', '', '', '', '', '', '', ''], ['', '', '', '', '', '', '', ''],
        ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'], ['T', 'C', 'A', 'D', 'R', 'A', 'C', 'T']
    ];

    let board = [], turn = 'white', selectedCell = null, possibleMoves = [];

    // Funciones de Control de Pantalla
    function showGame() { rulesSection.style.display = 'none'; gameSection.style.display = 'flex'; initGame(); }
    function showRules() { gameSection.style.display = 'none'; rulesSection.style.display = 'block'; }
    function closeModal() { modal.style.display = 'none'; }

    // L√≥gica del Juego
    function initGame() {
        board = JSON.parse(JSON.stringify(initialBoard));
        turn = 'white'; selectedCell = null; possibleMoves = [];
        renderBoard(); updateStatus(); closeModal();
    }

    function getPieceColor(p) { return p ? (p === p.toUpperCase() ? 'white' : 'black') : null; }

    function renderBoard() {
        boardElement.innerHTML = '';
        for (let r = 0; r < 8; r++) {
            for (let c = 0; c < 8; c++) {
                const cell = document.createElement('div');
                cell.className = `cell ${(r + c) % 2 === 0 ? 'white-cell' : 'black-cell'}`;
                const piece = board[r][c];
                if (piece) {
                    cell.textContent = piecesSymbols[piece];
                    cell.classList.add(getPieceColor(piece) === 'white' ? 'piece-white' : 'piece-black');
                }
                if (selectedCell?.r === r && selectedCell?.c === c) cell.classList.add('selected');
                const move = possibleMoves.find(m => m.r === r && m.c === c);
                if (move) {
                    cell.classList.add('highlight');
                    if (board[r][c]) cell.classList.add('capture');
                }
                cell.onclick = () => handleCellClick(r, c);
                boardElement.appendChild(cell);
            }
        }
    }

    function handleCellClick(r, c) {
        if (modal.style.display === 'flex') return;
        const clickedPiece = board[r][c];
        const move = possibleMoves.find(m => m.r === r && m.c === c);

        if (move) { executeMove(move); return; }
        if (clickedPiece && getPieceColor(clickedPiece) === turn) {
            selectedCell = { r, c }; calculateMoves(r, c, clickedPiece); renderBoard(); return;
        }
        selectedCell = null; possibleMoves = []; renderBoard();
    }

    function executeMove(move) {
        const target = board[move.r][move.c];
        const piece = board[selectedCell.r][selectedCell.c];
        const capturedColor = getPieceColor(target); // Color de la pieza comida (el que pierde)
        
        board[move.r][move.c] = piece;
        board[selectedCell.r][selectedCell.c] = '';
        
        turn = turn === 'white' ? 'black' : 'white';
        selectedCell = null; possibleMoves = [];
        renderBoard(); updateStatus();

        if (target !== '') triggerChallenge(capturedColor);
    }

    function triggerChallenge(loserColor) {
        const randomIndex = Math.floor(Math.random() * challenges.length);
        challengeTextElement.textContent = challenges[randomIndex];
        
        // Texto din√°mico para indicar qui√©n paga
        const loserName = loserColor === 'white' ? 'BLANCAS' : 'NEGRAS';
        loserIndicator.textContent = `El jugador de las ${loserName} debe hacer:`;
        loserIndicator.style.color = loserColor === 'white' ? '#fff' : '#000';
        loserIndicator.style.backgroundColor = loserColor === 'white' ? 'rgba(0,0,0,0.3)' : 'rgba(255,255,255,0.7)';

        modal.style.display = 'flex';
    }

    function updateStatus() {
        turnText.textContent = `Turno: ${turn === 'white' ? 'Blancas ‚ö™' : 'Negras ‚ö´'}`;
        turnText.className = turn === 'white' ? 'turn-white' : 'turn-black';
    }

    // Reglas de Movimiento (Simplificadas)
    function isValidPos(r, c) { return r >= 0 && r < 8 && c >= 0 && c < 8; }
    function calculateMoves(r, c, p) {
        possibleMoves = []; const type = p.toLowerCase(), color = getPieceColor(p);
        const dirs = { 't':[[0,1],[0,-1],[1,0],[-1,0]], 'a':[[1,1],[1,-1],[-1,1],[-1,-1]], 'c':[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]], 'd':[[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]], 'r':[[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]] };
        
        if (type === 'p') {
            const d = color === 'white' ? -1 : 1, start = color === 'white' ? 6 : 1;
            if (isValidPos(r+d, c) && !board[r+d][c]) { possibleMoves.push({r:r+d, c}); if (r===start && !board[r+d*2][c]) possibleMoves.push({r:r+d*2, c}); }
            [[d,1],[d,-1]].forEach(o => { const nr=r+o[0], nc=c+o[1]; if (isValidPos(nr,nc) && board[nr][nc] && getPieceColor(board[nr][nc])!==color) possibleMoves.push({r:nr, c:nc}); });
        } else if (['c','r'].includes(type)) {
            dirs[type].forEach(d => { const nr=r+d[0], nc=c+d[1]; if (isValidPos(nr,nc) && (!board[nr][nc] || getPieceColor(board[nr][nc])!==color)) possibleMoves.push({r:nr, c:nc}); });
        } else {
            dirs[type].forEach(d => { let nr=r+d[0], nc=c+d[1]; while(isValidPos(nr,nc)) { if (!board[nr][nc]) possibleMoves.push({r:nr, c:nc}); else { if (getPieceColor(board[nr][nc])!==color) possibleMoves.push({r:nr, c:nc}); break; } nr+=d[0]; nc+=d[1]; } });
        }
    }
</script>
</body>
</html>