<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sem√°foro Musical EF</title>
    <style>
        :root {
            --bg-color: #2d3436;
            --text-color: white;
            --green: #2ecc71;
            --red: #e74c3c;
            --yellow: #f1c40f;
            --blue: #0984e3;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background-color 0.3s;
        }

        /* --- ZONA SUPERIOR --- */
        #game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .light-circle {
            width: 35vh;
            height: 35vh;
            border-radius: 50%;
            background-color: #555;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 8rem;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            border: 10px solid rgba(255,255,255,0.2);
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 2;
        }
        
        .light-circle.pop { transform: scale(1.1); }

        .action-text {
            margin-top: 20px;
            font-size: 4rem;
            font-weight: bold;
            text-transform: uppercase;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
            text-align: center;
            z-index: 2;
        }

        /* --- ZONA INFERIOR --- */
        #controls-area {
            background-color: rgba(0,0,0,0.8);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }

        .controls-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 30px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s;
            font-family: inherit;
        }
        
        #btn-start { background-color: var(--green); color: white; box-shadow: 0 4px 0 #27ae60; }
        #btn-stop { background-color: var(--red); color: white; box-shadow: 0 4px 0 #c0392b; display: none; }
        button:active { transform: translateY(3px); box-shadow: none !important; }

        .speed-control {
            display: flex; align-items: center; gap: 10px; color: #bdc3c7;
            background: rgba(255,255,255,0.1); padding: 5px 20px; border-radius: 30px;
        }
        input[type=range] { cursor: pointer; }

        /* Leyenda */
        .legend { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        .legend-item {
            background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 8px;
            display: flex; align-items: center; gap: 10px; font-size: 0.9rem; border-left: 5px solid transparent;
        }
        .legend-icon { font-size: 1.5rem; }
        .l-green { border-color: var(--green); }
        .l-red { border-color: var(--red); }
        .l-yellow { border-color: var(--yellow); }
        .l-blue { border-color: var(--blue); }

        #countdown-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center;
            font-size: 15rem; font-weight: bold; color: white; z-index: 10;
        }

        /* Indicador de m√∫sica */
        .music-indicator { font-size: 0.8rem; color: #aaa; margin-left: 10px;}

        @media (max-width: 600px) {
            .light-circle { width: 25vh; height: 25vh; font-size: 5rem; }
            .action-text { font-size: 2.5rem; }
        }
    </style>
</head>
<body>

    <audio id="bg-music" loop>
        <source src="https://codeskulptor-demos.commondatastorage.googleapis.com/pang/paza-moduless.mp3" type="audio/mp3">
        Tu navegador no soporta audio.
    </audio>

    <div id="game-area">
        <div class="light-circle" id="main-circle">‚ö™</div>
        <div class="action-text" id="action-text">¬øLISTOS?</div>
    </div>

    <div id="countdown-overlay">3</div>

    <div id="controls-area">
        <div class="legend">
            <div class="legend-item l-green"><span class="legend-icon">üèÉ‚Äç‚ôÇÔ∏è</span><div><strong>VERDE</strong><br>Correr</div></div>
            <div class="legend-item l-red"><span class="legend-icon">üóø</span><div><strong>ROJO</strong><br>Estatua</div></div>
            <div class="legend-item l-yellow"><span class="legend-icon">üêå</span><div><strong>AMARILLO</strong><br>C√°mara Lenta</div></div>
            <div class="legend-item l-blue"><span class="legend-icon">üê∏</span><div><strong>AZUL</strong><br>Suelo y Salto</div></div>
        </div>

        <div class="controls-row">
            <div class="speed-control">
                <span>R√°pido</span>
                <input type="range" id="speed-slider" min="1000" max="5000" value="3000" step="500">
                <span>Lento</span>
                <span id="speed-display" style="font-weight:bold; color:white; width: 40px;">3s</span>
            </div>

            <button id="btn-start" onclick="startCountdown()">‚ñ∂ INICIAR CON M√öSICA üéµ</button>
            <button id="btn-stop" onclick="stopGame()">‚èπ DETENER</button>
        </div>
    </div>

<script>
    const states = [
        { color: '#2ecc71', name: 'VERDE', action: '¬°CORRER!', icon: 'üèÉ‚Äç‚ôÇÔ∏è', bg: '#27ae60' },
        { color: '#e74c3c', name: 'ROJO', action: '¬°ESTATUA!', icon: 'üóø', bg: '#c0392b' },
        { color: '#f1c40f', name: 'AMARILLO', action: 'C√ÅMARA LENTA', icon: 'üêå', bg: '#f39c12' },
        { color: '#0984e3', name: 'AZUL', action: '¬°SUELO Y SALTO!', icon: 'üê∏', bg: '#2980b9' }
    ];

    let gameInterval;
    let isPlaying = false;
    let lastIndex = -1;

    // Elementos
    const circle = document.getElementById('main-circle');
    const actionText = document.getElementById('action-text');
    const gameArea = document.getElementById('game-area');
    const btnStart = document.getElementById('btn-start');
    const btnStop = document.getElementById('btn-stop');
    const countdownOverlay = document.getElementById('countdown-overlay');
    const slider = document.getElementById('speed-slider');
    const speedDisplay = document.getElementById('speed-display');
    const music = document.getElementById('bg-music');

    // Configurar volumen inicial (50%)
    music.volume = 0.5;

    slider.oninput = function() {
        speedDisplay.textContent = (this.value / 1000) + 's';
        if (isPlaying) {
            clearInterval(gameInterval);
            gameInterval = setInterval(changeColor, this.value);
        }
    }

    function startCountdown() {
        // Necesario activar m√∫sica aqu√≠ por pol√≠ticas de navegadores
        music.currentTime = 0; // Reiniciar canci√≥n
        
        btnStart.style.display = 'none';
        btnStop.style.display = 'inline-block';
        countdownOverlay.style.display = 'flex';
        
        let count = 3;
        countdownOverlay.textContent = count;
        
        const countInterval = setInterval(() => {
            count--;
            if (count > 0) {
                countdownOverlay.textContent = count;
            } else {
                clearInterval(countInterval);
                countdownOverlay.style.display = 'none';
                startGame();
            }
        }, 1000);
    }

    function startGame() {
        isPlaying = true;
        
        // REPRODUCIR M√öSICA
        music.play().catch(e => console.log("Error de audio: ", e));
        
        changeColor();
        gameInterval = setInterval(changeColor, slider.value);
    }

    function stopGame() {
        isPlaying = false;
        clearInterval(gameInterval);
        
        // PAUSAR M√öSICA
        music.pause();
        
        btnStart.style.display = 'inline-block';
        btnStop.style.display = 'none';
        
        gameArea.style.backgroundColor = '#2d3436';
        circle.style.backgroundColor = '#555';
        circle.textContent = '‚ö™';
        actionText.textContent = 'PAUSA';
        lastIndex = -1;
    }

    function changeColor() {
        let newIndex;
        do {
            newIndex = Math.floor(Math.random() * states.length);
        } while (newIndex === lastIndex);
        
        lastIndex = newIndex;
        const state = states[newIndex];

        circle.style.backgroundColor = state.color;
        circle.textContent = state.icon;
        
        circle.classList.remove('pop');
        void circle.offsetWidth;
        circle.classList.add('pop');

        gameArea.style.backgroundColor = state.bg;
        actionText.textContent = state.action;
    }
</script>

</body>
</html>